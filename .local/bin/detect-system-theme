#!/bin/bash
# Detect system theme and output 'dark' or 'light'

# macOS detection
if [[ "$OSTYPE" == "darwin"* ]]; then
    if defaults read -g AppleInterfaceStyle 2>/dev/null | grep -q Dark; then
        echo -n "dark"
    else
        echo -n "light"
    fi
# Linux detection
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
    # Try GTK theme detection first
    if [[ -f "$HOME/.config/gtk-3.0/settings.ini" ]]; then
        gtk_theme=$(grep -i "gtk-application-prefer-dark-theme" "$HOME/.config/gtk-3.0/settings.ini" | cut -d= -f2 | xargs)
        if [[ "$gtk_theme" == "true" ]]; then
            echo -n "dark"
            return 0
        fi
    fi

    # Try dconf (GNOME)
    if command -v gsettings &> /dev/null; then
        if gsettings get org.gnome.desktop.interface gtk-application-prefer-dark-theme 2>/dev/null | grep -q true; then
            echo -n "dark"
            return 0
        fi
    fi

    # Try checking theme name from GTK settings
    if [[ -f "$HOME/.config/gtk-3.0/settings.ini" ]]; then
        gtk_name=$(grep -i "^gtk-theme-name" "$HOME/.config/gtk-3.0/settings.ini" | cut -d= -f2 | xargs)
        if [[ "$gtk_name" == *"dark"* ]] || [[ "$gtk_name" == *"Dark"* ]]; then
            echo -n "dark"
            return 0
        fi
    fi

    # Default to dark for Linux
    echo -n "dark"
else
    # Default to dark
    echo -n "dark"
fi
